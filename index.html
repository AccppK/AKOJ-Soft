<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKOJ 软件下载中心</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #f5f8ff;
            --accent-color: #ff6b6b;
        }
        /* [保持之前的所有CSS样式不变] */
    </style>
</head>
<body>
    <!-- [保持之前的HTML结构不变] -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 恢复JSON数据支持
            const defaultSoftwareData = [
                {
                    "name": "tinytask.exe",
                    "type": "Windows自动化工具",
                    "size": "2.1MB",
                    "description": "轻量级鼠标键盘操作录制工具",
                    "version": "1.2.3",
                    "update": "2023-08-15"
                },
                {
                    "name": "quickzip.zip",
                    "type": "压缩工具",
                    "size": "5.4MB",
                    "description": "高效文件压缩解压工具",
                    "version": "3.0.1",
                    "update": "2023-07-20"
                }
            ];

            async function fetchSoftwareList() {
                try {
                    const response = await fetch('software-list.json');
                    if (response.ok) {
                        const data = await response.json();
                        // 合并默认数据和远程数据
                        return [...defaultSoftwareData, ...(data.software || [])];
                    }
                    return defaultSoftwareData;
                } catch (error) {
                    console.error('加载JSON失败，使用默认数据:', error);
                    return defaultSoftwareData;
                }
            }

            // 增强型渲染函数
            async function renderSoftwareList(filter = '') {
                loadingEl.style.display = 'flex';
                softwareList.innerHTML = '';
                
                try {
                    const software = await fetchSoftwareList();
                    const filtered = software.filter(app => 
                        `${app.name}${app.type}${app.description || ''}`
                        .toLowerCase().includes(filter.toLowerCase())
                    );

                    if (filtered.length === 0) {
                        noResultsEl.style.display = 'block';
                        softwareList.style.display = 'none';
                    } else {
                        noResultsEl.style.display = 'none';
                        softwareList.style.display = 'flex';
                        
                        filtered.forEach(app => {
                            const card = document.createElement('div');
                            card.className = 'col-md-4 col-sm-6 mb-4';
                            card.innerHTML = `
                                <div class="card h-100">
                                    <span class="file-badge">${app.type}</span>
                                    <div class="card-body text-center pt-5">
                                        <div class="app-icon">
                                            <i class="bi ${getFileIcon(app.name.split('.').pop())}"></i>
                                        </div>
                                        <h5 class="card-title">${app.name}</h5>
                                        ${app.description ? `<p class="text-muted">${app.description}</p>` : ''}
                                        <div class="d-flex justify-content-between text-muted small mb-3">
                                            ${app.version ? `<span><i class="bi bi-tag"></i> v${app.version}</span>` : ''}
                                            ${app.update ? `<span><i class="bi bi-calendar"></i> ${app.update}</span>` : ''}
                                            <span><i class="bi bi-download"></i> ${app.size}</span>
                                        </div>
                                        <a href="./soft/${app.name}" class="btn btn-primary w-100" download>
                                            <i class="bi bi-download"></i> 立即下载
                                        </a>
                                    </div>
                                </div>
                            `;
                            softwareList.appendChild(card);
                        });
                    }
                } catch (error) {
                    console.error('渲染失败:', error);
                    softwareList.innerHTML = `
                        <div class="col-12 text-center text-danger py-5">
                            <i class="bi bi-exclamation-triangle-fill fs-1"></i>
                            <h3 class="mt-3">数据加载失败</h3>
                            <p>${error.message}</p>
                            <button onclick="location.reload()" class="btn btn-outline-primary mt-2">
                                <i class="bi bi-arrow-clockwise"></i> 重新加载
                            </button>
                        </div>
                    `;
                } finally {
                    loadingEl.style.display = 'none';
                }
            }

            // [保持其余代码不变]
        });
    </script>
</body>
</html>